(function(t){"use strict";var e=t.Phoenix,n,l;if(!e){t.Phoenix=e={}}n=e.SeamlessContent=e.SeamlessContent||{};n.Models=n.Models||{};var i=function(t){if("/"===t[0]){t=t.slice(1)}return t};l=n.Models.Page=Backbone.Model.extend({monitor:null,attributes:{adTargeting:null,content:null,guid:null,id:null,url:null,title:null,tracking:null},initialize:function(t){this.set("id",t.guid);this.set("content",$(t.content));this.set("url",i(t.url))},set:function(t,e,n){return Backbone.Model.prototype.set.call(this,t,e,_.extend({silent:true},n))}})})(this);
(function(e){"use strict";var t=e.Phoenix,n,i;if(!t){e.Phoenix=t={}}n=t.SeamlessContent=t.SeamlessContent||{};n.Collections=n.Collections||{};i=n.Collections.Pages=Backbone.Collection.extend({fetching:{},model:n.Models.Page,initialize:function(e,t){var n=this},fetch:function(e){var t=this,n=e.guid,i=e.url;if(!i||!n||true===t.isFetching(n)||true===t.has(n)){return}t.fetching[n]=true;return Backbone.Collection.prototype.fetch.call(t,{remove:false,url:i,type:"POST",dataType:"json",data:{ajax:1},complete:function(e,i){delete t.fetching[n]}})},has:function(e){return undefined!==this.get(e)},isFetching:function(e){return true===this.fetching[e]}})})(this);
(function(e){"use strict";var t=$(document),n=e.Phoenix,a,s,d;if(!n){e.Phoenix=n={}}a=n.SeamlessContent=n.SeamlessContent||{};s=a.Views=a.Views||{};var i=".js-mapped-ad .ad-wrap";d=s.Ads=Backbone.View.extend({SeamlessContent:null,eventName:"pageLoad",states:{hasAds:true,stubbedIds:[]},adsDefinedPages:{},initialize:function(t){var n=this,a=n.SeamlessContent=t.SeamlessContent,s=a.getCurrentPage(),d=$("#ad-settings"),i;if(d&&d.length>0){try{i=e.JSON.parse(d.attr("content"))}catch(e){i=null}}s.set("adTargeting",i);n.adsDefinedPages[s.get("guid")]=true;a.on("pageLoad",(function(e){console.warn("SEAMLESS pageLoad event triggered");n.getAds(e)}))},getAds:function(e){var n=this,a=e.get("guid"),s=n.adsDefinedPages,d=n.eventName+"-"+a,g,r;if(s[a]){return}g=e.get("content");r=g.find(i);r.attr("data-ad-event",d);t.trigger("on_ad_event",[d,{extendsAdContext:n.eventName,newTargeting:e.get("adTargeting"),adContextElement:g[0]}]);s[e.get("guid")]=true}})})(this);
(function(e){"use strict";var t=window,n=e.Phoenix,o,s;if(!n){e.Phoenix=n={}}o=n.SeamlessContent=n.SeamlessContent||{};s=o.Views=o.Views||{};var m=$('<br class="js-seamless-content__comments-stub hide" />');var a=".js-seamless-content__goto-comments";var i=function(e,t){var n=t.get("content"),o=n.find(a),s=o.find("svg");o.on("click",(function(t){t.preventDefault();e.gotoComments($(t.currentTarget).data("content-guid"))}));s.on("click",(function(e){e.preventDefault();e.stopPropagation();o.trigger("click")}))};var c=function(e,t){var n=t.get("content"),s=n.find(".js-seamless-content__comments"),a=s.find(".js-load-comments"),c=t.get("guid"),r;r=e.comments[c]={watcher:scrollMonitor.create(s,o.getMastheadOffsets()),$pod:s,$loader:a,$comments:null,$messages:null,$stub:null};a.one("commentsLoaded",(function(n,o){a.removeAttr("style");r.$comments=o;r.$messages=r.$comments.find(".js-forum-comments");r.$stub=m.clone();e.trigger("commentsLoaded");e.loadComments(t,true)}));i(e,t)};var r=function(e,t,n){if(!n){return}var o=t.get("guid"),s=e.comments[o].$loader;if(/#comments-block-(\d+)/i.test(n)&&s.attr("name")==="hash"){e.gotoComments(o)}};s.Comments=Backbone.View.extend({SeamlessContent:null,commentsByGuid:{},states:{currentIndex:0,nextIndex:1,openCommentsPageIndex:null},comments:{},initialize:function(e){var n=this,o=n.SeamlessContent=e.SeamlessContent,s=o.getCurrentPage();c(n,s);r(n,s,t.location.hash);o.on("pageAdded",(function(e){c(n,e)}))},gotoComments:function(e){var n=this,o=n.comments[e],s=o.watcher;if(s){t.scrollTo(0,s.top);o.$loader.trigger("click")}},closeComments:function(e,n){var o=this,s=e.get("guid"),m=o.comments[s],a=m.$pod,i=m.$loader,c=m.$comments,r=m.$messages,l,d;if(n){l=a.outerHeight()}c.before(i);i.on("click.seamless",(function(t){t.preventDefault();o.loadComments(e)}));c.addClass("hide");r.before(m.$stub);r.detach();if(n){d=a.outerHeight();if(l>d){t.scrollTo(0,scrollMonitor.viewportTop-(l-d))}}},loadComments:function(e,t){var n=this,o=n.SeamlessContent.Pages,s=o.indexOf(e),m=e.get("guid"),a=n.comments[m],i=n.states,c=i.openCommentsPageIndex,r=a.$loader,l=a.$comments,d=a.$messages,u=a.$stub;if(null!==c){n.closeComments(o.at(c),c<s)}if(!t){u.after(d);u.remove();r.remove();l.removeClass("hide")}i.openCommentsPageIndex=s}})})(this);
(function(t){"use strict";var e=t.Phoenix,n,s,i;if(!e){t.Phoenix=e={}}n=e.SeamlessContent=e.SeamlessContent||{};s=n.Views=n.Views||{};var u=function(t,e){var n=t.SeamlessContent.states.currentGuid,s,i=e.data("list-items"),u={},r;if(e.attr("data-list-items").indexOf(n)<0){i.unshift({guid:n,url:t.SeamlessContent.states.CurrentPage.get("url")})}$.each(i,(function(t,e){var i=e.guid;if(i===n){s=t}u[i]={index:t,listItemData:e}}));if(undefined!==s){r=i.slice(s+1)}else{r=i}if(r.length<1){r=null}t.states.currentIndex=s||-1;t.states.nextIndex=s+1;t.listItems=i;t.listItemsByGuid=u;t.unstitchedItems=r};i=s.ContentList=Backbone.View.extend({SeamlessContent:null,listItems:null,unstitchedItems:null,listItemsByGuid:{},states:{currentIndex:0,nextIndex:1},initialize:function(t){var e=this,n=e.els,s=e.SeamlessContent=t.SeamlessContent;u(e,e.$el);e.setCurrentItem(s.getCurrentPage());s.on("pageLoad",(function(t){e.setCurrentItem(t)}));s.on("pageAdded",(function(t){var n=t.get("guid"),s=e.listItemsByGuid[n],i=e.states.currentIndex=s.index;e.states.nextIndex=i+1}))},getNextItem:function(){var t=this,e=t.unstitchedItems,n;if(!e||e.length<1){return}n=e.shift();return n},getItem:function(t){var e=this,n=e.listItemsByGuid[t];if(undefined===n){return}return n},setCurrentItem:function(t){var e=this,n=t.get("guid"),s=e.getItem(n);e.trigger("setCurrentItem",s.index)}})})(this);
(function(e){"use strict";var t=$(document),n=$(window),r,i=e.scrollMonitor,a=e.Phoenix,o,s;if(!a){e.Phoenix=a={}}o=a.SeamlessContent=a.SeamlessContent||{};s=o.Views=o.Views||{};var g=".js-seamless-content__page-header";let u=0;let l=5;let c=true;let f=window.seamlessPercentScrolledThreshold?window.seamlessPercentScrolledThreshold:50;var d=false;var v=function(){d=true};var h=function(){var e=false;var t=function(){d=false;e=false};return function(){if(e){return}e=true;n.one("scroll",t)}}();var P=function(e,t,r){var a=t.get("content");var o=a.find(g);var s=i.create(o);var u=i.create(o,{bottom:50});var l=function(){if(d){return}if(true===r.isInViewport&&false===u.isBelowViewport&&false===u.isAboveViewport){e.setCurrentPage(t)}};u.stateChange((function(){n.off("scroll.stateChangeChecker");l()}));if(true===r.isInViewport&&false===u.isBelowViewport){n.one("scroll.stateChangeChecker",l)}s.stateChange((function(){if(d){return}if(true===s.isBelowViewport){e.setCurrentPage(e.getPrecedingPage(t))}}))};var w=function(e,t){var n=t.get("content");var r=i.create(n);var a=o.getMastheadOffsets();var s=i.create(n,a);var g=function(){var r=false;return function(){if(d){return}if(c===true){u+=1}let i=n.find(".js-seamless-content__page-content");let a=i[0].getBoundingClientRect();let o=Math.round((a.height-a.bottom)/a.height*100);if(c===true&&u<l&&o>0){return}r=!!e.getFollowingPage(t);if(false===r&&o>f){r=true;e.fetchNextPage()}if(true===r){window.removeEventListener("scroll",g);if(c===true){c=false}}}}();window.addEventListener("scroll",g);P(e,t,r);return{proper:r,offset:s}};var C=function(e,n){var r=n.get("content");e.els.$loading.before(r);e.watchers[n.get("guid")]=w(e,n);t.trigger("image-viewer-rescrape");r.find(".js-lazy-load-image").unveil({threshold:$(window).height()});r.find(".js-lazy-load-video").unveil({threshold:1500,delay:1e3,mode:"all"})};var m=function(e){r.text(e)};var p=function(){var e=false,n="pageLoad";var r=function(e){if(e&&e.om){e.om.link_location="down.1";e.om.url=location.href;e.om.page_title=document.title;if(!!e.cb){e.cb.title=document.title;e.cb.path=location.href}}return e};return function(i){t.trigger("pre_page_event");i=r(i);t.trigger("pre_tracking_event",[n,i,"replace"]);if(false===e){e=true;t.trigger("render_tracking_event",[n,true])}t.trigger("on_tracking_event",[n]);t.trigger("ajaxContentLoaded")}}();var L=function(e){if(!o.Router){return}var t=new o.Router({SeamlessContent:e});return t};var _=function(e){if(!o.Views.Comments){return}var t=new o.Views.Comments({SeamlessContent:e,el:e.el});return t};s.Core=Backbone.View.extend({Router:null,ContentList:null,Pages:null,els:{},events:{},states:{currentGuid:null,remainingContentCount:null,PreviousPage:null,CurrentPage:null},viewedPages:{},watchers:{},initialize:function(e){var t=this,n=e.currentPage,a=t.states.currentGuid=n.guid,g=e.els,u,l;r=g.$title;t.els=e.els;t.viewedPages[a]=true;t.Router=L(t);l=t.Pages=new o.Collections.Pages([n]);l.on("add",(function(e){t.toggleLoading(false);t.trigger("prePageAdded",e);C(t,e);t.trigger("pageAdded",e)}));u=t.states.CurrentPage=l.get(a);t.ContentList=new s.ContentList({SeamlessContent:t,el:g.$contentList,$listItems:g.$contentListItems});t.watchers[a]=w(t,u);t.watchers.container={proper:i.create(t.el),offset:i.create(t.el,o.getMastheadOffsets())};t.on("pageLoad",(function(e){var n=t.viewedPages,r=e.get("guid");if(!n[r]){n[r]=true;p(e.get("tracking"))}}));try{_(t)}catch(e){}},isViewedPage:function(e){return this.viewedPages[e.get("guid")]},getPrecedingPage:function(e){var t=this.Pages,n,r;n=t.indexOf(e);if(n>=1){r=t.at(n-1)}return r},getFollowingPage:function(e){var t=this.Pages,n=t.indexOf(e),r;if(n<t.length-1){r=t.at(n+1)}return r},getCurrentPage:function(){var e=this;return e.states.CurrentPage},getLastPage:function(){var e=this;return e.Pages.at(e.Pages.length-1)},setCurrentPage:function(e){var t=this,n=t.states,r;if(!!e){r=e.get("guid")}if(!r||n.currentGuid===r){return}n.currentGuid=r;t.trigger("prePageLoad",e);t.navigate(e.get("url"));m(e.get("title"));t.trigger("pageLoad",e);if(n.CurrentPage){n.PreviousPage=n.CurrentPage}n.CurrentPage=e;t.trigger("postPageLoad",e)},fetchNextPage:function(e){var t=this,n=t.ContentList,r=n.getNextItem();if(undefined===r){t.trigger("stopStitching");return true}t.Pages.fetch(r);if(!e){t.toggleLoading(true)}},navigate:function(e){var t=this.Router;if(t){t.navigate(e)}else{Backbone.history.navigate(e)}},scrollTo:function(e){if(!e){return}setTimeout((function(){window.scrollTo(0,e.offset.top)}))},gotoPage:function(e){var t=this,n=t.states,r=t.watchers,i=r[e],a;if(e===n.currentGuid){t.scrollTo(i);return}if(!i){location.reload();return}a=t.Pages.get(e);v();t.setCurrentPage(a);t.scrollTo(i);h()},waitForPage:function(e){var t=this,n=t.Pages,r;if(n.has(e)){t.gotoPage(e);return}v();a.Ui.showLoadingScreen("Loading...");t.on("pageAdded",r=function(e){t.off("pageAdded",r);a.Ui.hideLoadingScreen();t.gotoPage(e.get("guid"))});t.fetchNextPage(true);h()},toggleLoading:function(e){var t=this,n=t.els.$loading;if(!n||n.length<1){return}if(e){n.removeClass("hide")}else{n.addClass("hide")}}})})(this);
(function(e){"use strict";var t=e.Phoenix,n;if(!t){e.Phoenix=t={}}n=t.SeamlessContent=t.SeamlessContent||{};var o=function(){var e=t.ImageViewer;if(e&&e.App&&e.App.viewerOpen&&e.Routers&&e.Routers.AppRouter){e.Routers.AppRouter.closeViewer()}};n.Router=Backbone.Router.extend({SeamlessContent:null,loadImageTimeoutId:null,routes:{":path/":"checkPage","articles/:slug/:guid/":"loadPage"},initialize:function(e){var t=this;t.SeamlessContent=e.SeamlessContent},navigate:function(e,t){if(e.indexOf("/")!==0){e="/"+e}history.replaceState({},"",e)},checkPage:function(e){var t=this,n=t.SeamlessContent.Pages.where({url:e+"/"}),a;if(n.length>0){a=n[0]}if(!a){location.reload();return}t.SeamlessContent.gotoPage(a.get("guid"));o()},loadPage:function(e,t){this.SeamlessContent.gotoPage(t);o()}})})(this);
(function(t){"use strict";var e=$(".js-seamless-content"),n=$(".js-seamless-content__page"),s=n.find(".js-seamless-content__page-content"),i=$(".js-seamless-content__list"),a,r=false,o=false;if(i.length>0){if(i.is("meta")){r=true}else{a=i.find(".js-seamless-content__list-item");if(a.length>0){r=true}}}if(!e||!n||!s||!r||e.length<1||n.length<1||s.length<1){return}var l=t.scrollMonitor||false,f=t.Phoenix||{},u=f.SeamlessContent,c;if(!u||!l||!Backbone){return}c=u.Views;var d=function(){if(t.Modernizr){return t.Modernizr.history}return!!(window.history&&history.pushState)}();if(false===d){return}var h=function(t){var e=s.data("typeId"),r=s.data("guid"),o=$("head title");var l={content:n,guid:r,title:o.text(),url:window.location.pathname};var f=new c.Core({el:t,els:{$contentList:i,$contentListItems:a,$title:o,$loading:$(".js-seamless-content__loading")},typeId:e,url:window.location,currentPage:l});return f};var g=function(t){if(!c.Ads||false===o){return}new c.Ads({SeamlessContent:t})};var m=function(){if(false===Backbone.History.started){Backbone.history.start({pushState:true,silent:true})}};u.getMastheadOffsets=function(){var t=false;var e={top:0,bottom:0};return function(){var n;if(!t){t=true;n=$("#masthead");if(n&&n.length>0&&n.hasClass("is-nav-fixed")){e.top=n.outerHeight()}}return e}}();u.initialize=function(){try{var t=h(e);g(t);m()}catch(t){}};var v=$(document);if(f&&f.hasAds&&typeof f.hasAds==="function"&&f.hasAds()){o=true;v.one("ads_initialized",u.initialize)}else{$(u.initialize)}})(this);